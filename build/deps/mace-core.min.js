/*!
 * Mace 0.0.1
 * copyright: Takenori Nakagawa
 * license: MIT
 */
(function(){"use strict";var e;e=function(){function e(e,t,n){var r;this.editor=e,this.preview=null!=t?t:null,null==n&&(n={}),r=this,this.Ace={Range:ace.require("ace/range").Range},this.ace=ace.edit(this.editor),this.ace.getSession().setMode("ace/mode/markdown"),this.ace.setTheme("ace/theme/monokai"),marked.setOptions({renderer:new marked.Renderer,gfm:!0,tables:!0,breaks:!0,pedantic:!1,sanitize:!0,smartLists:!0,smartypants:!1}),null!==this.preview&&(this._render(),this.ace.on("change",function(e){return function(){return e._render()}}(this))),Object.defineProperty(this,"value",{get:function(){return this.ace.getValue()}}),Object.defineProperty(this,"font_size",{get:function(){return this.ace.getFontSize()},set:function(e){return this.ace.setFontSize(e)}})}return e.prototype._render=function(){var e;return e=this.ace.getValue(),marked(e,function(e){return function(t,n){return null!=t&&console.error(t),e.preview.innerHTML=n}}(this))},e.prototype.indent=function(e){var t,n;for(null==e&&(e=1),t=n=0;e>=0?e>n:n>e;t=e>=0?++n:--n)this.ace.indent();return this.ace.focus()},e.prototype.outdent=function(e){var t,n;for(null==e&&(e=1),t=n=0;e>=0?e>n:n>e;t=e>=0?++n:--n)this.ace.blockOutdent();return this.ace.focus()},e.prototype.heading=function(e){var t,n,r,i,o,s,c,a,u,h,l;if(null==e&&(e=1),0>e||e>6)throw new RangeError;for(r=this.ace.getCursorPosition(),i=this.ace.selection.getRange(),this.ace.selection.clearSelection(),0===i.end.column&&i.end.row-i.start.row===1&&i.end.row--,o=c=u=i.start.row,h=i.end.row;h>=u?h>=c:c>=h;o=h>=u?++c:--c)if(this.ace.moveCursorTo(o,0),s=this.getLineText(o),t=(null!=(l=s.match(/^#+/i))?l[0].length:void 0)||0,t!==e)for(n=a=t;e>=t?e>a:a>e;n=e>=t?++a:--a)e>t?this.ace.insert("#"):this.ace.remove("right");return this.ace.moveCursorTo(r.row,r.column+e-t),this.ace.focus()},e.prototype.link=function(e,t,n,r){var i,o;return null==e&&(e="./"),null==n&&(n=""),null==r&&(r=!1),o=this.ace.getCopyText().split("\n").join(""),t=t||o||"link",n.length>0&&(n=' "'+n+'"'),i=["","!"][+r],this.ace.insert(""+i+"["+t+"]("+e+n+")"),this.ace.focus()},e.prototype.getLineText=function(e){var t,n,r;return n=this.ace.getCursorPosition(),e=e||n.row,this.ace.moveCursorTo(e,0),this.ace.navigateLineEnd(),t=this.ace.getCursorPosition(),this.ace.selection.addRange(new this.Ace.Range(t.row,0,t.row,t.column)),r=this.ace.getCopyText(),this.ace.selection.clearSelection(),this.ace.moveCursorTo(n.row,n.column),r},e.prototype.list=function(e){var t,n,r,i,o,s,c,a,u,h,l,d,f;for(null==e&&(e="-"),o=this.ace.getCursorPosition(),s=this.ace.selection.getRange(),this.ace.selection.clearSelection(),0===s.end.column&&s.end.row-s.start.row===1&&s.end.row--,c=h=d=s.start.row,f=s.end.row;f>=d?f>=h:h>=f;c=f>=d?++h:--h)if(this.ace.moveCursorTo(c,0),u=this.getLineText(c),i=u.match(/^(\s*)[*-](\s*)[^*-][^]+/i),r=null!==i)for(n=null!=i?i[1].length:void 0,this.ace.moveCursorTo(c,n),a=null!=i?i[2].length:void 0,t=l=0;a>=0?a>=l:l>=a;t=a>=0?++l:--l)this.ace.remove("right");else this.ace.insert(""+e+" ");return this.ace.moveCursorTo(o.row,o.column+2),this.ace.focus()},e.prototype.clear=function(e){return null==e&&(e=!1),e?this.ace.setValue(""):this.ace.removeLines()},e}(),this.Mace=e}).call(this);